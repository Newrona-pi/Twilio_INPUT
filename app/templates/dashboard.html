<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twilio シナリオ管理画面</title>
    <link rel="stylesheet" href="/static/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>

<body>
    <header>
        <h1>Twilio シナリオ管理システム</h1>
        <nav>
            <button class="tab-btn active" onclick="openTab('tab-scenarios')">シナリオ設定</button>
            <button class="tab-btn" onclick="openTab('tab-numbers')">電話番号設定</button>
            <button class="tab-btn" onclick="openTab('tab-logs')">通話ログ・集計</button>
        </nav>
    </header>

    <main>
        <!-- Tab 1: Scenarios -->
        <section id="tab-scenarios" class="tab-content active">
            <div class="split-view">
                <!-- Left: List -->
                <div class="sidebar panel">
                    <h2>シナリオ一覧</h2>
                    <button class="create-btn" onclick="showCreateScenarioForm()">
                        <i class="fas fa-plus"></i> 新規作成
                    </button>
                    <ul id="scenario-list">
                        <!-- JS renders list here -->
                    </ul>
                </div>

                <!-- Right: Details -->
                <div class="content panel" id="scenario-detail-panel">
                    <div id="welcome-message" style="text-align: center; color: #999; margin-top: 50px;">
                        <p>左側のリストからシナリオを選択するか、<br>新規作成してください。</p>
                    </div>

                    <!-- Scenario Edit Form -->
                    <div id="scenario-editor" class="hidden">
                        <div class="header-actions">
                            <h2 id="editor-title">シナリオ編集</h2>
                            <div>
                                <button type="button" class="secondary small" onclick="copyCurrentScenario()">
                                    <i class="fas fa-copy"></i> コピーして新規作成
                                </button>
                                <button type="button" class="danger small" onclick="deleteCurrentScenario()">
                                    <i class="fas fa-trash"></i> 削除
                                </button>
                            </div>
                        </div>

                        <form id="scenario-form">
                            <input type="hidden" id="scenario-id">
                            <div class="form-group">
                                <label>シナリオ名 <span class="badge">管理用</span></label>
                                <input type="text" id="scenario-name" placeholder="例：キャンペーンA用" required>
                            </div>

                            <div class="form-group">
                                <label>挨拶メッセージ <span class="badge">AI発話</span></label>
                                <textarea id="scenario-greeting" placeholder="電話に出た直後に話す内容"></textarea>
                            </div>

                            <div class="form-group">
                                <label>免責事項・録音告知 <span class="badge">AI発話</span></label>
                                <textarea id="scenario-disclaimer" placeholder="挨拶の後に続く補足メッセージ"></textarea>
                            </div>

                            <div class="actions-right">
                                <button type="submit" class="primary">保存する</button>
                            </div>
                        </form>

                        <hr style="margin: 2rem 0; border: 0; border-top: 1px solid #eee;">

                        <!-- Questions Area -->
                        <div id="questions-area">
                            <h3>質問リスト <span class="description-inline">※この順序でAIが質問します</span></h3>

                            <div id="questions-container">
                                <!-- JS renders questions here -->
                            </div>

                            <div class="add-question-box">
                                <h4><i class="fas fa-plus-circle"></i> 質問を追加</h4>
                                <form id="question-form">
                                    <input type="hidden" id="question-id"> <!-- For editing -->
                                    <div class="form-group">
                                        <textarea id="question-text" placeholder="例：お名前をおっしゃってください。"
                                            required></textarea>
                                    </div>
                                    <!-- Order is handled automatically or via drag/drop in future, simple number for now -->
                                    <div class="form-row">
                                        <div class="form-group" style="width: 100px;">
                                            <label>順序</label>
                                            <input type="number" id="question-order" value="10" title="小さい順に実行されます">
                                        </div>
                                        <div class="actions-right" style="flex:1; align-items: flex-end;">
                                            <button type="button" class="secondary"
                                                onclick="resetQuestionForm()">クリア</button>
                                            <button type="submit">質問を保存</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tab 2: Phone Numbers (Same as before but simplified structure) -->
        <section id="tab-numbers" class="tab-content">
            <div class="panel">
                <h2>電話番号設定</h2>
                <div class="split-view-simple">
                    <div style="flex: 1; padding-right: 2rem; border-right: 1px solid #eee;">
                        <h3>新規紐付け</h3>
                        <form id="number-form">
                            <div class="form-group">
                                <label>電話番号</label>
                                <input type="text" id="phone-number" placeholder="+81..." required>
                            </div>
                            <div class="form-group">
                                <label>シナリオ</label>
                                <select id="number-scenario-select" required>
                                    <option>ロード中...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>ラベル</label>
                                <input type="text" id="phone-label" placeholder="〇〇店 代表電話">
                            </div>
                            <button type="submit">保存</button>
                        </form>
                    </div>
                    <div style="flex: 2; padding-left: 2rem;">
                        <h3>設定済み番号一覧</h3>
                        <table id="number-table">
                            <thead>
                                <tr>
                                    <th>番号</th>
                                    <th>シナリオ</th>
                                    <th>ラベル</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tab 3: Logs -->
        <section id="tab-logs" class="tab-content">
            <div class="panel">
                <div class="header-actions">
                    <h2>通話ログ</h2>
                    <div class="actions">
                        <input type="text" id="filter-to" placeholder="To番号で検索" class="search-input">
                        <button onclick="loadLogs()"><i class="fas fa-search"></i></button>
                        <button onclick="exportCSV()" class="secondary"><i class="fas fa-file-csv"></i> CSV出力</button>
                    </div>
                </div>
                <table id="logs-table">
                    <thead>
                        <tr>
                            <th>日時</th>
                            <th>From</th>
                            <th>To</th>
                            <th>シナリオ</th>
                            <th>回答データ</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </section>
    </main>

    <script src="/static/script.js"></script>
</body>

</html>